/** The Jedi Mindtrick for Learning Quickly */

/**
 * I've been interested in
 * productivity for years. As part
 * of my quest to become more
 * productive, my friend Gk and I
 */

/**
 * say-hi-to-gk.png
 */

/**
 * interviewed people we considered
 * as "highly productive"
 * programmers in an attempt to
 * discover what sets them apart.
 *
 * One programmer whom we
 * interviewed was the completely
 * amazing is the owner of India's
 * most successful accounting
 * package - Tally. In India, Tally
 * is ubiquitous. I have seen Tally
 * in small and dingy warehouses,
 * in brightly lit and expensive
 * high-end shops, in mom-and-pop
 * stores, and even in a police
 * station!
 *
 * BG, the owner of Tally
 * solutions, was for many years
 * also the sole developer, tester,
 * and bug-fixer. He is an
 * incredibly gifted and productive
 * programmer.
 */

/**
 * bg.png
 */

/**
 * "How do you learn new things?"
 * is one of the standard questions
 * we ask in our interviews. BG's
 * answer, however, was unexpected
 * and counterintuitive.
 *
 * "Whenever I'm learning
 * something new," BG said, "I
 * start by trying to guess how it
 * will work and then see how well
 * my guess pans out"
 *
 * "For example," he continued,
 * "When C++ introduced exceptions
 * I was excited to try them out.
 * But I started with trying to
 * guess what the syntax of a C++
 * exception would be before going
 * to look at the new standard."
 *
 * I nodded calmly, not wanting to
 * break the interview flow, but
 * inside I was in turmoil.
 *
 * WHY WOULD YOU DO THAT? I wanted
 * to yell, IT'S A WASTE OF TIME!
 * IT'S CRAZY!
 *
 * Instead, I waited for the
 * standard two second beat to let
 * him complete the thought if he
 * had more to say. Part of our
 * interview process was never
 * to challenge anything because
 * it leads to people shutting
 * down and not sharing things
 * they feel they cannot defend.
 *
 * Another principle was not to
 * discard anything - even if it
 * seemed counterintuitive -
 * without trying it out.
 *
 * So I tried it out...
 */

/**
 * suspense.png
 */

/**
 * ...and it worked! And worked
 * brilliantly. I found learning
 * new systems, new
 * technologies, almost anything
 * was much easier this way.
 */

/**
 * wtf.png
 */

/**
 * _Why does it work_? Well
 * after using it for a while
 * I think I understand. Here's
 * what happens.
 *
 * There are basically three
 * ways to learn:
 *  1. By dint of repetition
 */
/**
 * repetition.png
 */
/**
 *  2. By heightened emotion
 */
/**
 * hot-milk.png
 */
/**
 *  3. By association with what
 *     we already know.
 */
/**
 * baker-baker.png
 */
/**
 * The Baker/Baker paradox
 * illustrates this perfectly.
 * The way it goes is this.
 *
 * A researcher shows two people
 * the same photograph of a face
 * and tells one of them that
 * the guy is a baker and the
 * other that his last name is
 * Baker. A couple of days
 * later, the researcher shows
 * the same two subjects the
 * same photograph and asks for
 * the accompanying word.
 *
 * The person who was told the
 * man's worked as a baker is
 * much more likely to remember
 * it than the person who was
 * given his surname. Why should
 * that be?
 *
 * Same photograph. Same word.
 * Different amount of
 * remembering.
 *
 * This is because the
 * profession "baker" has a
 * strong net of associations
 * already in our memories.
 * Hence we can remember it far
 * more easily without needing a
 * lot of repetitions.
 */
/**
 * So now the idea of "guessing"
 * makes more sense. Making a
 * guess forces us to form
 * associations with things we
 * already know. Because we do
 * this, our learning moves from
 * needing repetition to
 * association which is far more
 * powerful.
 */

/**
 * What about emotion? Well we
 * realized that discounting the
 * emotional part of learning
 * was a mistake - it is greatly
 * helpful if we are invested
 * and truly care about the
 * outcome of the things we are
 * learning.
 *
 * How do we do this? By
 * applying the learning
 * immediatly into a goal we
 * truly desire. The goal itself
 * must be important to us - not
 * a pretend-goal to 'trick' us
 * into learning but a goal so
 * strong that it stands
 * independent of learning.
 */
/**
 * Now the entire Jedi Mind
 * trick for learning goes as
 * follows:
 * 1. Pick a goal we really care
 *    about. This must be
 *    something we really want
 *    and that we think can be
 *    accomplished by learning
 *    whatever we have taken up.
 * 2. Make a guess as to how to
 *    proceed (and be confident
 *    about it like a Jedi).
 * 3. Read/experiment and either
 *    confirm or correct your
 *    guess.
 */
/**
 * To show you how it works, I
 * will start the process now
 * and walk it with you.
 *
 * First, let's pick something
 * useful to learn. Because I've
 * bought my first Android
 * phone, I think Android
 * programming would be a good
 * subject.
 *
 * Now I have done iOS
 * programming but I've never
 * touched Android. I have no
 * idea how it works besides a
 * vague notion it uses Java. So
 * this is a good test for us to
 * walk together.
 */
/**
 * G:I want an andriod app similar to
 * the excellent "off the mind"
 * where I can quickly drop in
 * notes. I don't want an app
 * with lots of options, I just
 * need to single-touch, type,
 * forget.
 *
 * This is the app I built in
 * half a day going from ZERO
 * knowledge of Android to
 * publishing on the Play Store:
 */
/**
 * note-grabber-demo.gif
 */
/**
 * The app is available here:
 * https://play.google.com/store/apps/details?id=com.theproductiveprogrammer.notegrabber
 *
 * And now I will show you how
 * it was built by using the
 * "Jedi Mind Trick" of simply
 * making predictions and
 * checking them.
 *
 * P:Android is a java platform so
 * I should be able to use Eclipse.
 * I will need some emulators.
 *
 * X: The best way to develop an
 * andriod app is to use "the
 * andriod studio". Apparently it
 * organizes projects better and is
 * simpler for beginners. Plus
 * Android has officially
 * discontinued support for
 * Eclipse.
 *
 * So I'm going ahead and
 * installing Android Studio.
 *
 * P: Android studio will give me a
 * skeleton template to create an
 * app.
 *
 * Y: Yup. Create a new Android
 * Project is the first thing on
 * the list. Let's go!
 *
 * P: Will create a project with
 * lots of files and a skeleton app
 * that will show "hello world".
 *
 * X: Asking me to choose something
 * called "Activity". Not sure what
 * that is so let's guess.
 *
 * P: "Activity" is a set of
 * widgets and handlers to perform
 * some basic user interaction
 * behaviours.
 *
 * Selecting "Empty activity" and
 * going ahead.
 *
 * Y: The next page seems to say
 * that an "Activity" is a class
 * with a layout which I assume
 * contains the widgets.
 *
 * Y: Hah! Got a "Hello world!" :-)
 */
/**
 * 01.hello-world.png
 */
/**
 * P: The class will contain
 * methods that hook into the
 * layout and respond to user
 * actions.
 *
 * X: The class does not seem to
 * contain hook methods for the
 * layout. It contains one
 * lifecycle method (onCreate).
 *
 * Looking at all the methods it
 * could override shows that it
 * hooks into the lifecycle of
 * the application
 * (onPause,onResume,onLowMemory,
 * etc). It also appears to
 * contain hooks for the generic
 * andriod interface actions
 * (keydown, keyup, touch...) and
 * high level UI elements
 * (options menu, context menu,
 * toolbar,...)
 */

/**
 * (Moving this text to the
 * JediMindTrick.java file)
 */

/**
 * P: I will be able to find a
 * simple text entry widget and
 * replace the "Hello World" with
 * it.
 *
 * Y: Yup
 */
/**
 * 02.text-entry.png
 */
/**
 * P: I can add a button to the
 * top toolbar and respond when
 * the user clicks it.
 *
 * X: After trying to add a
 * button for a while and drag
 * it "nicely" to the toolbar it
 * just doesn't work.
 *
 * The top bar is not a
 * "toolbar" but an "actionbar".
 * According to the
 * documentation, we should not
 * use the action bar because it
 * behaves differently across
 * different releases of
 * Android. Instead we should
 * remove the action bar and
 * replace it with a library
 * "toolbar" which will behave
 * the same across releases.
 *
 * Okie-dokie.
 */
/**
 * 03.add-toolbar.png
 */
/**
 * P: I can add buttons to the
 * "toolbar" that I couldn't to
 * the "actionbar".
 *
 * X: Nope! I still can't.
 *
 * Turns out that I need to add
 * a "actions" to the toolbar
 * which are menu items.
 */
/**
 * 04.add-actions.png
 */
/**
 * Whoops! The toolbar is
 * floating on top of the edit
 * text box! The first few lines
 * of the text box are hidden
 * under the toolbar.
 *
 * P: There will be a simple
 * layout that can stack one
 * component and then the other
 *
 * X: It turns out that the
 * simplest way is simply to add
 * a padding to the top of the
 * editbox as the toolbar is
 * fixed in size.
 */
/**
 * 05.fix-editbox.png
 */
/**
 * P: When the action button
 * (the email) is clicked I can
 * access the typed in text.
 *
 * P: The control type is "Multi
 * line Text" but in order to
 * access it I will need to know
 * it's class. I see a "EditText"
 * which looks hopeful so let's try
 * that.
 *
 * Y: Yup it works:
 */
/**
 * 06.get-usertext.png
 */
/**
 * Now I need a way to store this
 * so we don't lose it when the app
 * quits.
 *
 * P: The way to save data is to
 * open a file and write to it.
 *
 * X: There are actually _three_
 * ways to save data:
 *  1. Key-value properties
 *  2. File (- as we guessed -)
 *  3. SQL Lite database.
 *
 * We'll go ahead and continue
 * saving our notes in a file.
 *
 * P: There will be a standard
 * location we can use to store
 * our files.
 *
 * Y: Yup. There's a
 * `getFilesDir()` method that
 * gives us the location we
 * need.
 *
 * P: We can save and read the
 * file data easily.
 *
 * Y: Yup. Using input and
 * output streams with simple
 * code samples.
 */
/**
 * 07.save-and-load.png
 */
/**
 * Whenever I save now, it
 * appends to the file. So I
 * need to do two things:
 * 1. Clear the text after each
 *    save.
 * 2. Put a "header" between
 *    each save to differentiate
 *    them.
 *
 * I also need a simple way to
 * clear all notes. For this, I
 * will add a "delete" button.
 *
 * P: There will be a simple way
 * to delete files by name.
 *
 * Y: File.delete(). :-D
 *
 * (As all this code is
 * similar to what we've done
 * before I'm not going to show
 * it here but you can see it in
 * the actual code below)
 */
/**
 * Now we make the app really
 * useful! How? Well when we
 * start we bring up the
 * keyboard and whenever we stop
 * we save and clear.
 *
 * P: To bring up the keyboard I
 * can set focus to the EditText
 * on start.
 *
 * X: I can bring up the keyboard
 * when an activity is launched.
 * After reading a bit more on
 * "Activity" this makes sense -
 * we should be able to start
 * the user interface with the
 * keyboard if needed.
 */
/**
 * 08.show-keyboard.png
 */
/**
 * P: There will be an event I
 * can override for stopping
 * the app.
 *
 * Y: Yup. It's called onPause()
 *
 * Moving the code to
 * onPause()...
 *
 * When I use it, I save notes
 * by dismissing the app. I'd
 * like to do this within the
 * app rather than going "out"
 * to the _Home_/_Back_ button.
 *
 * P: I can add a "back" action
 * to the toolbar and position
 * it to the left.
 *
 * X: The toolbar is structured
 * and has these components:
 *  (a) Navigation
 *  (b) Icon
 *  (c) Title/Subtitle
 *  (d) Actions/Menu
 *  (e) Custom views
 * So what we are looking for is
 * to enable the "navigation"
 * and use it to dismiss the
 * application. This will
 * trigger the onPause and save
 * our note.
 *
 * P: There is a simple way to
 * dismiss an application.
 *
 * Y: Yes, we simply need to
 * close all current dialogs etc
 * and move the task to the
 * back of the activity stack.
 */
/**
 * 09.dismissed.png
 */
/**
 * One issue we have so far is
 * the "delete" button just
 * deletes. We should ask the
 * user if they actually want to
 * delete or they touched the
 * button by mistake.
 *
 * Ideally we should provide an
 * "UNDO" option but I can't
 * figure out how the UI for
 * that would look so let's go
 * with a simple confirmation
 * for now.
 *
 * P: There should be some sort
 * of simple MessageBox class I
 * can use.
 *
 * X: Apparently not so simple.
 * I have to create a
 * "DialogFragment" and use
 * that. This is because we can
 * use fragments to manage
 * sub-views with their own
 * lifecycles. Dialog is a
 * 'standard' sub-view but it's
 * been generalized to a
 * fragment.
 *
 * P: The fragment itself will
 * handle the confirm/ignore
 * buttons so we make it an
 * inner class.
 *
 * Y: Yup.
 */
/**
 * 10.confirm-dialog.png
 */
/**
 * Now all that's left is to
 * send an email when the email
 * button is clicked!
 *
 * P: There must be a class that
 * helps us send emails.
 *
 * X: The better way is to
 * register an 'intent' and
 * allow the user to use his or
 * her existing client.
 *
 * (Also discovered a nice UI
 * element called "Toast" to
 * show brief feedback messages)
 */
/**
 * 11.email.png
 */
/**
 * And finally, let's create some
 * icons and we're done with the
 * application!
 */
/**
 * 12.app-icon.png
 */
/**
 * Now the last thing to do is
 * publish it on the playstore.
 *
 * P: It will be easy and free
 * to publish the app on the
 * playstore.
 *
 * X: Awp!! I have to pay to get
 * my free app shared! Sigh.
 * Otherwise it was easy enough!
 * It's available here:
 *
 * https://play.google.com/store/apps/details?id=com.theproductiveprogrammer.notegrabber
 *
 * Well - from Android Zero to
 * Hero in half a day! All
 * because I can use the Jedi
 * Mind Trick! :-)
 *
 * Let me know how it works out
 * for you and if you have any
 * doubts in the comments.
 *
 */
package blog.theproductiveprogrammer.notegrabber;

import android.app.Dialog;
import android.content.Context;
import android.content.DialogInterface;
import android.content.Intent;
import android.support.v4.app.DialogFragment;
import android.support.v7.app.AlertDialog;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.support.v7.widget.Toolbar;
import android.util.Log;
import android.view.Gravity;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.widget.EditText;
import android.widget.Toast;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.InputStreamReader;
import java.text.SimpleDateFormat;
import java.util.Date;

public class JediMindTrick extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Toolbar myToolbar = (Toolbar) findViewById(R.id.my_toolbar);
        setSupportActionBar(myToolbar);
        myToolbar.setNavigationOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                finish();
                moveTaskToBack(true);
            }
        });
    }

    @Override
    protected void onPause() {
        super.onPause();
        dumpText();
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        if(item.getItemId() == R.id.exportEmail) {
            dumpText();
            return export_notes_in_email_1();
        }
        if(item.getItemId() == R.id.deleteNotes) {
            dumpText();
            deleteSavedNotes();
            return true;
        }
        return super.onOptionsItemSelected(item);
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.main_actions, menu);
        return true;
    }

    String filename = "jedimind";

    private String loadText() {
        FileInputStream inputStream;
        try {
            inputStream = openFileInput(filename);
            return to_string_1(inputStream);
        } catch (Exception e) {
            //uncomment to debug: e.printStackTrace();
        }
        return "";
    }
    private static String to_string_1(FileInputStream is) throws Exception {
        BufferedReader reader = new BufferedReader(new InputStreamReader(is));
        StringBuilder sb = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null) {
            sb.append(line).append("\n");
        }
        reader.close();
        return sb.toString();
    }

    private void saveText() {
        FileOutputStream outputStream;

        String usertxt = get_user_text_1();
        if(usertxt == null) return;

        try {
            outputStream = openFileOutput(filename, Context.MODE_APPEND);
            outputStream.write(getCurrentTimeStamp().getBytes());
            outputStream.write("\n==================\n".getBytes());
            outputStream.write(usertxt.getBytes());
            outputStream.write("\n\n\n\n".getBytes());
            outputStream.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    private String get_user_text_1() {
        EditText user_text = (EditText) findViewById(R.id.editText);
        String usertxt = user_text.getText().toString();
        if(usertxt == null) return null;
        usertxt = usertxt.trim();
        if(usertxt.length() == 0) return null;
        return usertxt;
    }

    private void dumpText() {
        saveText();
        clear_text_1();
    }
    private void clear_text_1() {
        EditText user_text = (EditText) findViewById(R.id.editText);
        user_text.getText().clear();
    }

    public static class ConfirmDelete extends DialogFragment {
        @Override
        public Dialog onCreateDialog(Bundle savedInstanceState) {
            Bundle args = getArguments();
            final String todelete = args.getString("PATH_TO_DELETE");

            // Use the Builder class for convenient dialog construction
            AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());
            builder.setMessage("Clear all notes?")
                    .setPositiveButton("Clear", new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int id) {
                            new File(todelete).delete();
                            Toast toast = Toast.makeText(getContext(), "Notes Cleared", Toast.LENGTH_SHORT);
                            toast.setGravity(Gravity.CENTER, 0, 0);
                            toast.show();
                        }
                    })
                    .setNegativeButton("No", new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int id) {
                            // Do nothing - User cancelled the dialog
                        }
                    });
            // Create the AlertDialog object and return it
            return builder.create();
        }
    }

    private void deleteSavedNotes() {
        DialogFragment dialogFragment = new ConfirmDelete();
        Bundle args = new Bundle();
        args.putString("PATH_TO_DELETE", new File(getFilesDir(), filename).getAbsolutePath());
        dialogFragment.setArguments(args);
        dialogFragment.show(getSupportFragmentManager(), "confirmdialog_tag");
    }

    private String getCurrentTimeStamp() {
        SimpleDateFormat format = new SimpleDateFormat("MMM dd, yyyy HH:mm");
        return format.format(new Date());
    }

    private boolean export_notes_in_email_1() {
        String subject = "Note Grabber (" + getCurrentTimeStamp() + ")";
        String body = loadText();

        Intent i = new Intent(Intent.ACTION_SEND);
        i.setType("message/rfc822");
        i.putExtra(Intent.EXTRA_SUBJECT, subject);
        i.putExtra(Intent.EXTRA_TEXT, body);
        try {
            startActivity(Intent.createChooser(i, "Send mail..."));
            return true;
        } catch (android.content.ActivityNotFoundException ex) {
            Toast.makeText(this,
                    "There are no email clients installed.",
                    Toast.LENGTH_SHORT).show();
            return false;
        }
    }

}
